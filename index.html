<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‚¬ì§„ â†’ ASCII ë³€í™˜ê¸°</title>
  <style>
    :root{
      --bg1:#0f1115; --bg2:#171a25; --ink:#e6ecff; --muted:#a6b0d4; --line:#2a2f42;
      --panel:#141826; --panel2:#0f1422; --accent:#9dffce;
    }
    html,body{height:100%}
    body{margin:0; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Noto Sans KR", monospace; background: radial-gradient(1000px 600px at 50% -10%, var(--bg2), var(--bg1)); color:var(--ink); display:grid; place-items:start center}
    .app{width:min(1100px,96vw); padding:18px 18px 36px}
    h1{margin:0 0 8px; font-size:20px}
    .sub{margin:0 0 12px; font-size:12px; color:var(--muted)}

    .grid{display:grid; grid-template-columns: 320px 1fr; gap:14px}
    @media (max-width: 880px){ .grid{grid-template-columns: 1fr} }

    .card{background: linear-gradient(180deg, var(--panel), var(--panel2)); border:1px solid var(--line); border-radius:16px; padding:14px}
    .row{display:flex; align-items:center; gap:10px; margin:10px 0}
    label{font-size:12px; color:var(--muted); width:120px}
    input[type="range"]{width: 100%}
    .switch{display:flex; gap:10px; flex-wrap:wrap}
    .switch > label{width:auto}

    .drop{border:1px dashed #2f3755; border-radius:14px; padding:16px; text-align:center; color:#c8d0f3; background: rgba(255,255,255,.02)}
    .drop.drag{background: rgba(157,255,206,.06); border-color:#57ffc2}
    .drop input{display:none}
    .thumb{margin-top:10px; font-size:12px; color:var(--muted)}

    .btns{display:flex; flex-wrap:wrap; gap:8px}
    button{appearance:none; border:1px solid #3a415f; background:#1a2033; color:var(--ink); padding:9px 12px; border-radius:10px; cursor:pointer; font-weight:700}
    button:hover{background:#232a45}

    .ascii-wrap{position:relative; border:1px solid var(--line); border-radius:14px; overflow:auto; background:#0b0e16}
    .ascii{white-space: pre; font: 12px/12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; padding:14px; margin:0}
    .ascii.color{white-space: pre; font: 12px/12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

    .bar{height:8px; border-radius:999px; background:#1a2136; outline: 1px solid #2a2f42; overflow:hidden}
    .bar > i{display:block; height:100%; width:0%; background: linear-gradient(90deg, #b3c2ff, #7ae1ff)}

    .footer{margin-top:10px; font-size:11px; color:var(--muted)}
  </style>
</head>
<body>
  <div class="app">
    <h1>ì‚¬ì§„ â†’ ASCII ë³€í™˜ê¸°</h1>
    <p class="sub">ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ë„ ì„œë²„ë¡œ ì „ì†¡ë˜ì§€ ì•Šì•„ìš”.</p>

    <div class="grid">
      <!-- ì¢Œì¸¡ íŒ¨ë„ -->
      <div class="card">
        <div class="drop" id="drop">
          <p style="margin:0 0 6px">ì´ë¯¸ì§€ ëŒì–´ë†“ê¸° ë˜ëŠ” ì„ íƒí•˜ê¸°</p>
          <label for="file" style="display:inline-block; padding:6px 10px; border:1px solid #3a415f; border-radius:8px; cursor:pointer;">íŒŒì¼ ì„ íƒ</label>
          <input id="file" type="file" accept="image/*" />
          <div class="thumb" id="thumb">ì•„ì§ íŒŒì¼ ì—†ìŒ</div>
        </div>

        <div class="row">
          <label>ë¬¸ì ì„¸íŠ¸</label>
          <select id="charset">
            <option value="@%#*+=-:. ">@%#*+=-:. (Dense)</option>
            <option value="MWN0QOZodc+|=;:,._ ">ë¸”ë¡+ê¸°í˜¸ í˜¼í•©</option>
            <option value="â–ˆâ–“â–’â–‘ .">ë¸”ë¡ (ì„ ëª…)</option>
            <option value="@$B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/|()1{}[]?-_+~<>i!lI;:,\^`'. ">ì¥ë¬¸ì(ì •êµ)</option>
          </select>
        </div>
        <div class="row">
          <label>ê°€ë¡œ ë¬¸ì ìˆ˜</label>
          <input id="cols" type="range" min="40" max="320" step="4" value="140" />
          <span id="colsVal" style="width:50px; text-align:right">140</span>
        </div>
        <div class="row">
          <label>ëª…ì•” ëŒ€ë¹„</label>
          <input id="contrast" type="range" min="0.5" max="2.0" step="0.05" value="1.0" />
          <span id="contrastVal" style="width:50px; text-align:right">1.00</span>
        </div>
        <div class="row">
          <label>ë¬¸ì ì¢…íš¡ë¹„</label>
          <input id="aspect" type="range" min="1.6" max="2.4" step="0.05" value="2.0" />
          <span id="aspectVal" style="width:50px; text-align:right">2.00</span>
        </div>
        <div class="row switch">
          <label><input id="invert" type="checkbox" /> ë°ê¸° ë°˜ì „</label>
          <label><input id="colorize" type="checkbox" /> ì»¬ëŸ¬ ASCII</label>
          <label><input id="dither" type="checkbox" /> ë””ë”ë§</label>
          <label><input id="bgdark" type="checkbox" checked /> ë‹¤í¬ ë°°ê²½</label>
        </div>
        <div class="row btns">
          <button id="renderBtn">ë³€í™˜í•˜ê¸°</button>
          <button id="copyBtn">ë³µì‚¬</button>
          <button id="txtBtn">TXT ì €ì¥</button>
          <button id="pngBtn">PNG ì €ì¥</button>
        </div>
        <div class="row" style="align-items:center; gap:10px">
          <label>ì§„í–‰</label>
          <div class="bar" style="flex:1"><i id="progress"></i></div>
          <span id="progLabel" style="font-size:11px; color:var(--muted); width:48px; text-align:right">0%</span>
        </div>
      </div>

      <!-- ìš°ì¸¡ ì¶œë ¥ -->
      <div class="card ascii-wrap" id="outWrap">
        <pre id="ascii" class="ascii"></pre>
      </div>
    </div>

    <p class="footer">Tip: ì´ ì‚¬ì´íŠ¸ëŠ” 2025ë…„ 8ì›” ì¹œêµ¬ë“¤ì˜ ìš”ì²­ì— ì˜í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤. </p>
    <p class="footer">ì»¬ëŸ¬ ASCIIëŠ” <em>ë³µì‚¬</em> ì‹œ HTMLì´ ë³µì‚¬ë˜ê³ , <em>TXT</em>ëŠ” í‘ë°± í…ìŠ¤íŠ¸ê°€ ì €ì¥ë©ë‹ˆë‹¤. PNG ì €ì¥ì€ ë Œë”ë§ëœ ì•„íŠ¸ë¥¼ ì´ë¯¸ì§€ë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤.</p>
  </div>

  <canvas id="work" style="display:none"></canvas>
  <script>
  const $ = (id) => document.getElementById(id);
  const file = $('file'), drop = $('drop'), thumb=$('thumb');
  const asciiEl = $('ascii'), outWrap=$('outWrap');
  const charsetSel = $('charset');
  const colsRange=$('cols'), colsVal=$('colsVal');
  const contrastRange=$('contrast'), contrastVal=$('contrastVal');
  const aspectRange=$('aspect'), aspectVal=$('aspectVal');
  const invertChk=$('invert'), colorChk=$('colorize'), ditherChk=$('dither'), bgdark=$('bgdark');
  const renderBtn=$('renderBtn'), copyBtn=$('copyBtn'), txtBtn=$('txtBtn'), pngBtn=$('pngBtn');
  const progressBar=$('progress'), progLabel=$('progLabel');
  const work = $('work'); const wctx = work.getContext('2d', { willReadFrequently: true });

  let img = new Image();
  let imgURL = null;
  let lastHTML = '';

  function setProgress(p){ p=Math.max(0,Math.min(1,p)); progressBar.style.width=(p*100).toFixed(0)+'%'; progLabel.textContent=(p*100).toFixed(0)+'%'; }

  function numberLabel(range, label){ const upd=()=>label.textContent=(+range.value).toFixed(range.step.includes('.')?2:0); range.addEventListener('input',upd); upd(); }
  numberLabel(colsRange, colsVal); numberLabel(contrastRange, contrastVal); numberLabel(aspectRange, aspectVal);

  // Drag & Drop
  drop.addEventListener('dragover', (e)=>{e.preventDefault(); drop.classList.add('drag');});
  drop.addEventListener('dragleave', ()=>drop.classList.remove('drag'));
  drop.addEventListener('drop', (e)=>{ e.preventDefault(); drop.classList.remove('drag'); if(e.dataTransfer.files && e.dataTransfer.files[0]) loadFile(e.dataTransfer.files[0]); });
  file.addEventListener('change', ()=>{ if(file.files[0]) loadFile(file.files[0]); });

  function loadFile(f){
    if(!f.type.startsWith('image/')){ alert('ì´ë¯¸ì§€ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.'); return; }
    if(imgURL) URL.revokeObjectURL(imgURL); imgURL = URL.createObjectURL(f);
    img.onload=()=>{ thumb.textContent = `${f.name} (${img.naturalWidth}Ã—${img.naturalHeight})`; setProgress(0); autosize(); render(); };
    img.onerror=()=>alert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    img.src = imgURL;
  }

  function autosize(){
    if(!img.naturalWidth) return;
    const targetW = Math.min(200, Math.max(100, Math.round(img.naturalWidth/8))); // ì´ˆê¹ƒê°’ ëŒ€ëµí™”
    colsRange.value = targetW; colsVal.textContent = targetW;
  }

  function drawDownscaled(cols, rows){
    work.width = cols; work.height = rows;
    wctx.imageSmoothingEnabled = true;
    wctx.imageSmoothingQuality = 'high';
    wctx.clearRect(0,0,cols,rows);
    wctx.drawImage(img, 0, 0, cols, rows);
  }

  function getCharForLuma(luma, charset, invert){
    // luma: 0..255 -> index 0..len-1
    const len = charset.length; if(len===0) return ' ';
    let t = luma / 255; // 0..1
    // contrast
    const c = parseFloat(contrastRange.value);
    t = (t - 0.5) * c + 0.5; t = Math.max(0, Math.min(1, t));
    if(invert) t = 1 - t;
    let idx = Math.floor(t * (len-1));
    return charset[idx];
  }

  function floydSteinberg(grayArr, w, h){
    // grayArr: Uint8Array (0..255)
    for(let y=0;y<h;y++){
      for(let x=0;x<w;x++){
        const i = y*w + x;
        const old = grayArr[i];
        const newV = old < 128 ? 0 : 255;
        const err = old - newV;
        grayArr[i] = newV;
        const a=err*7/16, b=err*3/16, c=err*5/16, d=err*1/16;
        if(x+1<w) grayArr[i+1] = clamp(grayArr[i+1]+a,0,255);
        if(x>0 && y+1<h) grayArr[i+w-1] = clamp(grayArr[i+w-1]+b,0,255);
        if(y+1<h) grayArr[i+w] = clamp(grayArr[i+w]+c,0,255);
        if(x+1<w && y+1<h) grayArr[i+w+1] = clamp(grayArr[i+w+1]+d,0,255);
      }
    }
  }

  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function render(){
    if(!img.naturalWidth){ alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ë¶ˆëŸ¬ì˜¤ì„¸ìš”.'); return; }

    const cols = parseInt(colsRange.value,10);
    const aspect = parseFloat(aspectRange.value); // charHeight = aspect * charWidth
    const charW = 1, charH = aspect; // ìƒ˜í”Œìš© ë¹„ìœ¨ë§Œ í•„ìš”

    const rows = Math.max(1, Math.floor(img.naturalHeight / (img.naturalWidth/cols) / aspect));

    drawDownscaled(cols, rows);
    const { data } = wctx.getImageData(0,0,cols,rows);

    const charset = charsetSel.value;
    const invert = invertChk.checked;
    const colored = colorChk.checked;
    const dith = ditherChk.checked;

    const gray = new Uint8Array(cols*rows);

    setProgress(0);
    // 1) ê·¸ë ˆì´/ì»¬ëŸ¬ ìƒ˜í”Œë§
    for(let y=0;y<rows;y++){
      for(let x=0;x<cols;x++){
        const i = (y*cols + x)*4;
        const r = data[i], g = data[i+1], b = data[i+2];
        const luma = Math.round(0.2126*r + 0.7152*g + 0.0722*b);
        gray[y*cols+x] = luma;
      }
      if(y%20===0) setProgress(y/rows*0.4);
    }

    // 2) ë””ë”ë§(ì„ íƒ)
    if(dith){ floydSteinberg(gray, cols, rows); }
    setProgress(0.45);

    // 3) ë¬¸ìì—´ ì¡°ë¦½
    let html = '';
    let text = '';
    const bgc = bgdark.checked ? '#0b0e16' : '#ffffff';
    asciiEl.style.background = bgc;
    asciiEl.classList.toggle('color', colored);
    asciiEl.style.color = bgdark.checked? '#e6ecff':'#111';

    for(let y=0;y<rows;y++){
      let lineHTML = '', lineTXT = '';
      for(let x=0;x<cols;x++){
        const l = gray[y*cols+x];
        const ch = getCharForLuma(l, charset, invert);
        lineTXT += ch;
        if(colored){
          const i = (y*cols + x)*4;
          const r = data[i], g = data[i+1], b = data[i+2];
          lineHTML += `<span style="color:rgb(${r},${g},${b})">${ch === '<' ? '&lt;' : ch === '>' ? '&gt;' : ch === '&' ? '&amp;' : ch}</span>`;
        }else{
          lineHTML += (ch === '<' ? '&lt;' : ch === '>' ? '&gt;' : ch === '&' ? '&amp;' : ch);
        }
      }
      html += lineHTML + (y<rows-1?'\n':'');
      text += lineTXT + (y<rows-1?'\n':'');
      if(y%20===0) setProgress(0.45 + y/rows*0.5);
    }
    setProgress(1);

    lastHTML = html;
    asciiEl.innerHTML = html;
    // ìŠ¤í¬ë¡¤ ë§¨ ìœ„ë¡œ
    outWrap.scrollTop = 0;
  }

  renderBtn.addEventListener('click', render);
  invertChk.addEventListener('change', render);
  colorChk.addEventListener('change', render);
  ditherChk.addEventListener('change', render);
  bgdark.addEventListener('change', render);
  charsetSel.addEventListener('change', render);
  colsRange.addEventListener('change', render);
  contrastRange.addEventListener('change', render);
  aspectRange.addEventListener('change', render);

  // ë³µì‚¬: ì»¬ëŸ¬ëŠ” HTML, í‘ë°±ì€ í…ìŠ¤íŠ¸
  copyBtn.addEventListener('click', async ()=>{
    const colored = colorChk.checked;
    if(colored){
      const blob = new Blob([`<pre style="white-space:pre; font:12px/12px ui-monospace, Menlo, Consolas, monospace; background:${bgdark.checked?'#0b0e16':'#fff'}; color:${bgdark.checked?'#e6ecff':'#111'}">${lastHTML}</pre>`], {type:'text/html'});
      await navigator.clipboard.write([ new ClipboardItem({ 'text/html': blob }) ]).catch(async ()=>{
        // fallback: plain text
        await navigator.clipboard.writeText(asciiEl.innerText);
      });
    }else{
      await navigator.clipboard.writeText(asciiEl.innerText);
    }
    alert('í´ë¦½ë³´ë“œë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
  });

  // TXT ì €ì¥ (í‘ë°± í…ìŠ¤íŠ¸)
  txtBtn.addEventListener('click', ()=>{
    const blob = new Blob([asciiEl.innerText], {type:'text/plain;charset=utf-8'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'ascii_art.txt'; a.click(); URL.revokeObjectURL(a.href);
  });

  // PNG ì €ì¥: í˜„ì¬ ì¶œë ¥(ì»¬ëŸ¬/í‘ë°±) ê·¸ëŒ€ë¡œ ìº”ë²„ìŠ¤ì— ê·¸ë ¤ì„œ ì´ë¯¸ì§€ë¡œ
  pngBtn.addEventListener('click', ()=>{
    const lines = asciiEl.innerText.split('\n');
    const fontSize = 12; const lineH = 12; // ascii cssì™€ ë™ì¼
    // ì¤„ ì¤‘ ê°€ì¥ ê¸´ ê¸¸ì´
    const cols = lines.reduce((m,l)=>Math.max(m, l.length), 0);
    const pad = 14; const W = cols*fontSize + pad*2; const H = lines.length*lineH + pad*2;
    const cnv = document.createElement('canvas'); cnv.width=W; cnv.height=H;
    const ctx = cnv.getContext('2d');
    ctx.fillStyle = bgdark.checked? '#0b0e16':'#ffffff'; ctx.fillRect(0,0,W,H);
    ctx.font = `${fontSize}px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace`;
    ctx.textBaseline = 'top';

    if(colorChk.checked){
      // HTMLì„ íŒŒì‹±í•˜ì§€ ì•Šê³ , ë¹ ë¥¸ ê·¼ì‚¬: ê° ë¬¸ìì˜ ìƒ‰ì„ ë‹¤ì‹œ ìƒ˜í”Œë§
      // í™”ë©´ ë Œë” ê¸°ì¤€ìœ¼ë¡œ cols/rows ê³„ì‚°
      const colsNow = lines[0]?.length || parseInt(colsRange.value,10);
      const aspect = parseFloat(aspectRange.value);
      const rowsNow = lines.length;
      // ê¸°ì¡´ downscaled ë²„í¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
      const imgData = wctx.getImageData(0,0,colsNow,rowsNow).data;
      for(let y=0;y<rowsNow;y++){
        for(let x=0;x<colsNow;x++){
          const ch = lines[y][x] || ' ';
          const i = (y*colsNow + x)*4;
          const r=imgData[i], g=imgData[i+1], b=imgData[i+2];
          ctx.fillStyle = `rgb(${r},${g},${b})`;
          ctx.fillText(ch, pad + x*fontSize, pad + y*lineH);
        }
      }
    }else{
      ctx.fillStyle = bgdark.checked? '#e6ecff':'#111111';
      for(let y=0;y<lines.length;y++){
        ctx.fillText(lines[y], pad, pad + y*lineH);
      }
    }

    const url = cnv.toDataURL('image/png');
    const a = document.createElement('a'); a.href = url; a.download = 'ascii_art.png'; a.click();
  });

  // ì´ˆê¸° ì•ˆë‚´ ì˜ˆì‹œ
  asciiEl.textContent = [
    'ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦¬ë©´ ì´ ì˜ì—­ì— ASCII ì•„íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.',
    '',
    'â€¢ ê°€ë¡œ ë¬¸ì ìˆ˜ë¡œ í•´ìƒë„ë¥¼ ì¡°ì ˆí•˜ì„¸ìš”.',
    'â€¢ ë¬¸ì ì¢…íš¡ë¹„ëŠ” ê¸€ì ì„¸ë¡œ ë¹„ìœ¨(ë³´í†µ 2.0 ê·¼ì²˜)ì„ ì¡°ì •í•©ë‹ˆë‹¤.',
    'â€¢ ë””ë”ë§ì„ ì¼œë©´ ì ë¬˜ ëŠë‚Œì´ ê°•í•´ì§‘ë‹ˆë‹¤.',
    'â€¢ ì»¬ëŸ¬ ASCIIë¥¼ ì¼œê³  PNGë¡œ ì €ì¥í•˜ë©´ ì»¬ëŸ¬ë¡œ ì €ì¥ë©ë‹ˆë‹¤.'
  ].join('\n');
  </script>
</body>

<section id="guestbook" class="card" style="margin-top:16px">
  <h2 style="margin:0 0 8px;font-size:16px">ğŸ“ ASCII ë°©ëª…ë¡</h2>
  <p style="margin:0 0 10px;color:#a6b0d4;font-size:12px">
    ì–´ë–¤ ê±¸ ë§Œë“¤ì—ˆë‚˜ìš”? <b>ë°˜ë“œì‹œ</b> ì½”ë“œë¸”ë¡ìœ¼ë¡œ ì˜¬ë ¤ì£¼ì„¸ìš”:
    <code>```</code>ë¡œ ì‹œì‘í•˜ê³  ëë‚´ê¸°.
  </p>

  <script src="https://utteranc.es/client.js"
          repo="hyunhyunwork/AAwork"
          issue-term="pathname"
          theme="github-dark"
          crossorigin="anonymous"
          async>
  </script>
</section>

  <script src="https://utteranc.es/client.js"
          repo="hyunhyunwork
</section>
</html>
